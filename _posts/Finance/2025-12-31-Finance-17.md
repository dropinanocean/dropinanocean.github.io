---
layout: post
title: "VBAL Holdings Tracker"
categories: finance
published: true
---

<div style="margin-bottom: 15px; font-weight: bold;">
  **Goal ({{ site.data.vbal.goal_year }}):** {{ site.data.vbal.goal }} VBAL shares
</div>

<div id="vbal-counter" style="font-size: 3rem; font-weight: bold; margin-bottom: 15px;">
  Loadingâ€¦
</div>

<div style="max-width: 500px; margin-bottom: 15px;">
  <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“Š Share Count Progress</div>
  <div style="background: #eee; border-radius: 8px; overflow: hidden; position: relative; height: 30px;">
    <div id="vbal-progress"
         style="background: #4caf50; height: 100%; width: 0%; transition: width 0.8s; display: flex; align-items: center; justify-content: flex-end; padding-right: 8px; color: white; font-weight: bold;">
      <!-- progress label -->
    </div>
    <div style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #666; font-size: 0.9rem;">
      Goal: {{ site.data.vbal.goal }}
    </div>
  </div>
  <div id="vbal-percent" style="margin-top: 8px; font-weight: 600;">
    Loadingâ€¦
  </div>
</div>

<div style="max-width: 500px; margin-bottom: 15px;">
  <div style="font-weight: bold; margin-bottom: 8px;">ğŸ’µ Portfolio Worth Progress</div>
  <div style="background: #eee; border-radius: 8px; overflow: hidden; position: relative; height: 30px;">
    <div id="goal-progress"
         style="background: #ffc107; height: 100%; width: 0%; transition: width 0.8s; display: flex; align-items: center; justify-content: flex-end; padding-right: 8px; color: #333; font-weight: bold; font-size: 0.9rem;">
      <!-- progress label -->
    </div>
    <div style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #666; font-size: 0.9rem;">
      Goal: <span id="goal-label">Loadingâ€¦</span>
    </div>
  </div>
  <div id="goal-percent" style="margin-top: 8px; font-weight: 600; color: #ffc107;">
    Loadingâ€¦
  </div>
</div>

### ğŸ’µ Portfolio Worth
<div style="max-width: 500px; margin-bottom: 15px; padding: 12px; background: #1e3a5f; border-left: 4px solid #2196f3; border-radius: 4px; color: white;">
  <div style="margin-bottom: 8px;">
    <strong>ğŸ“ˆ VBAL Price:</strong> <span id="vbal-price" style="color: white; font-weight: bold;">Loadingâ€¦</span>
  </div>
  <div style="margin-bottom: 8px;">
    <strong>ğŸ“Š Total Shares:</strong> <span id="total-shares" style="color: white;">Loadingâ€¦</span>
  </div>
  <div style="font-size: 1.5rem; color: #4caf50; font-weight: bold;">
    ğŸ’° Portfolio Value: <span id="portfolio-worth">Loadingâ€¦</span>
  </div>
  <div style="font-size: 0.9rem; color: #ccc; margin-top: 8px;">
    ğŸ• Last updated: <span id="price-update-time">Loadingâ€¦</span>
  </div>
</div>
### ğŸ¯ Goal Portfolio Value
<div style="max-width: 500px; margin-bottom: 15px; padding: 12px; background: #1e3a5f; border-left: 4px solid #ffc107; border-radius: 4px; color: white;">
  <div style="margin-bottom: 8px;">
    <strong>ğŸ”¢ Goal Shares:</strong> <span id="goal-shares" style="color: white;">Loadingâ€¦</span>
  </div>
  <div style="font-size: 1.5rem; color: #ffc107; font-weight: bold;">
    ğŸ¯ Goal Value: <span id="goal-worth">Loadingâ€¦</span>
  </div>
  <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #444;">
    <strong>Amount Needed:</strong> <span id="amount-needed" style="color: #ff6b6b; font-weight: bold;">Loadingâ€¦</span>
  </div>
</div>


<script>
  const goalShares = {{ site.data.vbal.goal }};
  const goalYear = "{{ site.data.vbal.goal_year }}";
  const accounts = {{ site.data.vbal.accounts | jsonify }};

  let totalVBALShares = 0;
  for (const key in accounts) {
    totalVBALShares += accounts[key].shares;
  }

  const percent = Math.min((totalVBALShares / goalShares) * 100, 100);

  const numberFormat = {
    minimumFractionDigits: 0,
    maximumFractionDigits: 5
  };
  
  const currencyFormat = {
    style: 'currency',
    currency: 'CAD',
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  };

  // Counter
  document.getElementById("vbal-counter").innerText =
    totalVBALShares.toLocaleString(undefined, numberFormat) + " shares";

  // Progress bar
  const progressEl = document.getElementById("vbal-progress");
  progressEl.style.width = percent.toFixed(2) + "%";

  // Percent text
  document.getElementById("vbal-percent").innerText =
    percent.toFixed(2) + "% of " + goalYear + " goal achieved (" +
    (goalShares - totalVBALShares).toLocaleString(undefined, numberFormat) +
    " shares remaining)";
  
  // Fetch VBAL price from Google Finance via Alpha Vantage API
  function fetchVBALPrice() {
    // Free API key from https://www.alphavantage.co/
    const apiKey = 'TEHZ7RZZ6OVAF8MN'; // Replace with your free API key
    const alphaVantageUrl = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=VBAL.TO&apikey=${apiKey}`;
    
    fetch(alphaVantageUrl)
      .then(response => response.json())
      .then(data => {
        if (data['Global Quote'] && data['Global Quote']['05. price']) {
          const vbalPrice = parseFloat(data['Global Quote']['05. price']);
          const portfolioWorth = totalVBALShares * vbalPrice;
          const goalWorth = goalShares * vbalPrice;
          const amountNeeded = goalWorth - portfolioWorth;
          
          // Display price
          document.getElementById("vbal-price").innerText = 
            "$" + vbalPrice.toFixed(2) + " CAD";
          
          // Display total shares
          document.getElementById("total-shares").innerText = 
            totalVBALShares.toLocaleString(undefined, numberFormat) + " shares";
          
          // Display portfolio worth
          document.getElementById("portfolio-worth").innerText = 
            portfolioWorth.toLocaleString(undefined, currencyFormat);
          
          // Display goal shares
          document.getElementById("goal-shares").innerText = 
            goalShares.toLocaleString(undefined, numberFormat) + " shares";
          
          // Display goal worth
          document.getElementById("goal-worth").innerText = 
            goalWorth.toLocaleString(undefined, currencyFormat);
          
          // Calculate and display goal progress
          const goalPercent = Math.min((portfolioWorth / goalWorth) * 100, 100);
          const goalProgressEl = document.getElementById("goal-progress");
          goalProgressEl.style.width = goalPercent.toFixed(2) + "%";
          goalProgressEl.innerText = goalPercent.toFixed(1) + "%";
          
          document.getElementById("goal-label").innerText = 
            goalWorth.toLocaleString(undefined, currencyFormat);
          
          document.getElementById("goal-percent").innerText = 
            goalPercent.toFixed(2) + "% of goal reached (" +
            amountNeeded.toLocaleString(undefined, currencyFormat) +
            " remaining)";
          
          // Display amount needed
          document.getElementById("amount-needed").innerText = 
            amountNeeded.toLocaleString(undefined, currencyFormat);
          
          // Display update time
          const now = new Date();
          const timeString = now.toLocaleString('en-CA', { 
            year: 'numeric', 
            month: 'short', 
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
          document.getElementById("price-update-time").innerText = timeString + " ET";
        } else {
          throw new Error('Invalid response from Alpha Vantage API');
        }
      })
      .catch(error => {
        console.error('Error fetching VBAL price:', error);
        document.getElementById("vbal-price").innerText = "Unable to fetch price";
        document.getElementById("portfolio-worth").innerText = "â€”";
        document.getElementById("price-update-time").innerText = "Error loading";
      });
  }
  
  // Fetch price on page load
  fetchVBALPrice();
  
  // Refresh price every 5 minutes (respects free tier rate limits)
  setInterval(fetchVBALPrice, 5 * 60 * 1000);
</script>
